<div class="klondike-container flex flex-column flex-nowrap justify-content-start align-items-stretch p-2">
    <div class="klondike-container flex-auto flex flex-column flex-nowrap justify-content-start align-items-stretch row-gap-2">
        <div>
            <app-top-bar></app-top-bar>
        </div>
        <div class="flex-auto flex flex-column flex-nowrap justify-content-start align-items-stretch row-gap-2 ">
            <div class="klondike-top-container flex flex-row flex-nowrap justify-content-between align-items-start">
                <div class="flex-auto flex flex-row flex-nowrap justify-content-start column-gap-4">
                    <div *ngFor="let f of board.foundation; let i = index" pDroppable (onDrop)="dropOnFoundation(i, f)" class="klondike-card-stack">
                        <div class="klondike-card"
                        [ngClass]="{
                            'bg-card-clubs': i === 0,
                            'bg-card-diamonds': i === 1,
                            'bg-card-hearts': i === 2,
                            'bg-card-spades': i === 3
                        }"></div>
                        <div class="klondike-card"
                        *ngFor="let card of f; let j = index"
                        [ngStyle]="{'background-image': 'url(../../../assets/cards/'+ card.picture +'.svg)'}"
                        pDraggable
                        (onDragStart)="dragStart($event, f, j)"
                        (onDragEnd)="dragEnd()"></div>
                    </div>
                    <!-- <div pDroppable (onDrop)="dropOnFoundation(CardSuit.Diamonds, this.board.foundation[1])" class="klondike-card-stack">
                        <div *ngIf="this.board.foundation[1].length == 0" class="klondike-card bg-card-diamonds"></div>
                        <div class="klondike-card"
                        *ngFor="let card of board.foundation[1]; let i = index"
                        [ngStyle]="{'background-image': 'url(../../../assets/cards/'+ card.picture +'.svg)'}"
                        pDraggable
                        (onDragStart)="dragStart($event, board.foundation[1], i)"
                        (onDragEnd)="dragEnd()"></div>
                    </div>
                    <div pDroppable (onDrop)="dropOnFoundation(CardSuit.Spades ,board.foundationSpades)" class="klondike-card-stack">
                        <div *ngIf="board.foundationSpades.length == 0" class="klondike-card bg-card-spades"></div>
                        <div class="klondike-card"
                        *ngFor="let card of board.foundationSpades; let i = index"
                        [ngStyle]="{'background-image': 'url(../../../assets/cards/'+ card.picture +'.svg)'}"
                        pDraggable
                        (onDragStart)="dragStart($event, board.foundationSpades, i)"
                        (onDragEnd)="dragEnd()"></div>
                    </div>
                    <div pDroppable (onDrop)="dropOnFoundation(CardSuit.Clubs ,board.foundationClubs)" class="klondike-card-stack">
                        <div *ngIf="board.foundationClubs.length == 0" class="klondike-card bg-card-clubs"></div>
                        <div class="klondike-card"
                        *ngFor="let card of board.foundationClubs; let i = index"
                        [ngStyle]="{'background-image': 'url(../../../assets/cards/'+ card.picture +'.svg)'}"
                        pDraggable
                        (onDragStart)="dragStart($event, board.foundationClubs, i)"
                        (onDragEnd)="dragEnd()"></div>
                    </div> -->
                </div>
                <div class="klondike-deck-container flex-auto flex flex-row flex-nowrap justify-content-end gap-4">
                    <div class="klondike-card-stack"
                    [ngClass]="{
                        'deck-waste-spread-1': board.deckWaste.length < 2,
                        'deck-waste-spread-2': board.deckWaste.length == 2,
                        'deck-waste-spread-3': board.deckWaste.length > 2,
                        
                    }">
                        <div  class="klondike-card bg-card-placeholder"></div>
                        <div class="klondike-card"
                        *ngFor="let card of board.deckWaste; let i = index"
                        [ngStyle]="{'background-image': 'url(../../../assets/cards/'+ card.picture +'.svg)'}"
                        pDraggable
                        (onDragStart)="dragStart($event, board.deckWaste, i)"
                        (onDragEnd)="dragEnd()"></div>
                    </div>
                    <div class="klondike-card" (click)="board.draw()" 
                    [ngClass]="{'bg-card-back': board.deckStock.length != 0, 'bg-card-placeholder': board.deckStock.length == 0}"></div>
                </div>
            </div>
            <div class="klondike-tableau-container flex-auto flex flex-row justify-content-evenly align-items-start overflow-hidden gap-2">
                <div *ngFor="let tab of board.tableau" pDroppable (onDrop)="dropOnTableau(tab)">
                    <div class="klondike-card bg-card-tableau-placeholder"></div>
                    <div class="klondike-card"
                    *ngFor="let card of tab; let i = index"
                    [ngClass]="{
                        'tableau-stack-element': i !== 0 && tab.length < 15,
                        'tableau-stack-element-compact': i !== 0 && tab.length >= 15 && tab.length < 18,
                        'tableau-stack-element-ultra-compact': i !== 0 && tab.length >= 18,
                        'non-interactable': !(card.movable)
                    }"
                    [ngStyle]="{'background-image': (card.faceShown)? 'url(../../../assets/cards/'+ card.picture +'.svg)' : 'url(../../../assets/cards/back_1.svg'}"
                    pDraggable
                    (onDragStart)="dragStart($event, tab, i)"
                    (onDragEnd)="dragEnd()"></div>
                </div>
            </div>
        </div>
    </div>
    <div id="card-stack-dragged">
        <div class="klondike-card"
        *ngFor="let card of draggedCards; let i = index" 
        [ngClass]="{
            'tableau-stack-element': i !== 0 && draggedCardsOrigin!.length < 15,
            'tableau-stack-element-compact': i !== 0 && draggedCardsOrigin!.length >= 15 && draggedCardsOrigin!.length < 18,
            'tableau-stack-element-ultra-compact': i !== 0 && draggedCardsOrigin!.length >= 18
        }"
        [ngStyle]="{'background-image': 'url(../../../assets/cards/'+ card.picture +'.svg)'}"></div>
    </div>
    <div id="ghost-image"></div>
    <div id="demo-buttons">
        <p-button (onClick)="startNewGame()">Restart game</p-button>
        <p-button (onClick)="changeDifficulty()">Change difficulty</p-button>
    </div>
</div>